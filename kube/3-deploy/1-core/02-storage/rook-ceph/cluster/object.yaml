---
apiVersion: ceph.rook.io/v1
kind: CephObjectRealm
metadata:
  name: ${CLUSTER_NAME_LOWER}
  namespace: rook-ceph
---
apiVersion: ceph.rook.io/v1
kind: CephObjectZoneGroup
metadata:
  name: ${CLUSTER_NAME_LOWER}
  namespace: rook-ceph
spec:
  realm: "${CLUSTER_NAME_LOWER}"
---
apiVersion: ceph.rook.io/v1
kind: CephObjectZone
metadata:
  name: ${CLUSTER_NAME_LOWER}
  namespace: rook-ceph
spec:
  zoneGroup: "${CLUSTER_NAME_LOWER}"
  metadataPool:
    failureDomain: host
    replicated:
      size: 3
    parameters:
      compression_mode: aggressive
      compression_algorithm: zstd
  dataPool:
    failureDomain: host
    replicated:
      size: 3
    parameters:
      compression_mode: aggressive
      compression_algorithm: zstd
---
apiVersion: ceph.rook.io/v1
kind: CephObjectStore
metadata:
  name: ${CLUSTER_NAME_LOWER}
  namespace: rook-ceph
spec:
  zone:
    name: "${CLUSTER_NAME_LOWER}"
  preservePoolsOnDelete: true
  gateway:
    sslCertificateRef: radosgw-tls
    securePort: 443
    instances: 2
    service:
      annotations:
        "io.cilium/lb-ipam-ips": "${APP_IP_RADOSGW}"
    resources:
      limits:
        memory: "2048Mi"
      requests:
        cpu: "100m"
        memory: "1024Mi"
    priorityClassName: system-cluster-critical
---
apiVersion: v1
kind: Service
metadata:
  annotations:
    io.cilium/lb-ipam-ips: 10.12.34.3
  labels:
    app: rook-ceph-rgw
    ceph_daemon_id: biohazard
    rgw: biohazard
    rook_cluster: rook-ceph
    rook_object_store: biohazard
  name: rook-ceph-rgw-biohazard
  namespace: rook-ceph
spec:
  type: LoadBalancer
  externalIPs:
    - 10.12.34.3
  ports:
  - name: https
    port: 443
    protocol: TCP
    targetPort: 443
  selector:
    app: rook-ceph-rgw
    ceph_daemon_id: biohazard
    rgw: biohazard
    rook_cluster: rook-ceph
    rook_object_store: biohazard
  externalTrafficPolicy: Local
