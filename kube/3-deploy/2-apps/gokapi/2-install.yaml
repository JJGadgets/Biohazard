apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: gokapi
    namespace: gokapi
spec:
    interval: 15m
    chart:
        spec:
            chart: app-template
            version: 1.2.1
            sourceRef:
                kind: HelmRepository
                name: bjw-s
                namespace: flux-system
    maxHistory: 3
    install:
        createNamespace: true
        remediation:
            retries: 3
    upgrade:
        cleanupOnFail: true
        remediation:
            retries: 3
    uninstall:
        keepHistory: false
    values:
        controller:
            strategy: RollingUpdate
        image:
            repository: docker.io/f0rc3/gokapi
            tag: v1.6.1
        service:
            main:
                ports:
                    http:
                        port: 53842
        env:
            GOKAPI_MAX_MEMORY_UPLOAD: "128"
            GOKAPI_PORT: 53842
        ingress:
            main:
                enabled: true
                ingressClassName: nginx
                hosts:
                    - host: ENC[AES256_GCM,data:iGBRHViY8RGC,iv:WqePEM2IwE993k6NgsUBSy+ZrAfl07gmyt4dcjQhESk=,tag:Mm6vSaLlsculjoads/nLFA==,type:str]
                      paths:
                        - path: ENC[AES256_GCM,data:Jw==,iv:l5M6sJIqbOumVLMRITp7YeSj/kLZNyL42BWTYCnoaXk=,tag:kR7JNKp6oWzDiU5Xu/0scQ==,type:str]
                          pathType: ENC[AES256_GCM,data:s44Q4MY6,iv:5z+qXUnRv2adT1u/cRs3efGKTNb+N8MKwSdEXHX/yLA=,tag:T3QNhv7uDN6OR1laYA9cKA==,type:str]
                tls:
                    - hosts:
                        - ENC[AES256_GCM,data:4mS4BfxKopdw,iv:XSyJLpXQfDxWuFiVLEdVHD0BdP+2FuRcOBPKF2tgCh0=,tag:6WTKNn6VLU5aVWEbGQSSxw==,type:str]
        persistence:
            config:
                enabled: true
                type: pvc
                mountPath: /app/config
                readOnly: false
                accessMode: ReadWriteOnce
                size: 1Gi
                storageClass: block
                retain: true
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1u57l4s400gqstc0p485j4646cemntufr0pcyp32yudklsp90xpmszxvnkj
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBOVGFCdHZOWU05Y20wTWJM
            UnJqMk9KRlpYZTJZWmRpUXM3Vmg3S2Z1NEVRCjZXUlNqNFN5ZENtdXBJODMvNk1L
            cFl0K0E1V2dEdjI4NFhoeHUyTFgwb3cKLS0tIDRvZWVtWllhTHNNUUJ4dnc0SzUx
            MHc3cXY5ZnZBU0gva05ZME5BaG1ZWHMKO1P60Ffaes6oc2fOsPE7QwLc0d3L03ct
            Gj9CzvDAp082iCPiltkFh0VYK2tvJqlcdgmUzYH9tx2htrj4vOPzdw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-02-21T20:13:21Z"
    mac: ENC[AES256_GCM,data:Ugg0AMersR0PFfGJAmVUi1iOBvqcCopz9+UkdL06gaK7NaH5FD5NHOdHdptfIYmRKyW8f3TIxGeCuIHvj0r0YNiAdewg7TvQC+szVxFqr4tGL3bZOnRoq8wSieU+KcqpbixNWsTBzj1EDppcBbcURJE5hMEYa8Ky+kYcPCco2cM=,iv:Guh2GTV/Es4PPMxCPev+cPHyY7qOgHp7/y4Mz4oB5+U=,tag:/JtocwkkvY515Ao4xcPERQ==,type:str]
    pgp:
        - created_at: "2023-02-21T20:13:20Z"
          enc: |
            -----BEGIN PGP MESSAGE-----

            hF4DAAAAAAAAAAASAQdAdPeZBy4qD/YDcKd768reWw5ek8Sm1YNO6IJpdv1t4Wcw
            HdnOt+LYufbzlzELIp1lHVKOQsiCT/dXv7H3yB9CIqwNR+EJzGEjJKbc4JA7W3Tw
            0l4Bs73x9OfOfFnkhKcjUK/3kp2w4leDbtb3tEvLlCOestKc4yc0uA1Hq+dG4PnR
            TfkLHmjrisapgrrtyHsEYfzvHPzuCFa0rfdxms50in3ryVR7QRRX2eZOeP8F5Wyd
            =bvOF
            -----END PGP MESSAGE-----
          fp: 31E70E5BC80C58AFF5DD649921AC5A1AC6E5B7F2
    encrypted_regex: ^(hosts|host)$
    version: 3.7.3
