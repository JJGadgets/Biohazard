apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: gokapi
    namespace: gokapi
spec:
    interval: 15m
    chart:
        spec:
            chart: app-template
            version: 1.2.1
            sourceRef:
                kind: HelmRepository
                name: bjw-s
                namespace: flux-system
    maxHistory: 3
    install:
        createNamespace: true
        remediation:
            retries: 3
    upgrade:
        cleanupOnFail: true
        remediation:
            retries: 3
    uninstall:
        keepHistory: false
    values:
        controller:
            strategy: RollingUpdate
        image:
            repository: docker.io/f0rc3/gokapi
            tag: v1.6.1
        service:
            main:
                ports:
                    http:
                        port: 53842
        env:
            GOKAPI_MAX_MEMORY_UPLOAD: "128"
            GOKAPI_PORT: 53842
        ingress:
            main:
                enabled: true
                ingressClassName: nginx
                hosts:
                    - host: ENC[AES256_GCM,data:b88yyG5HfDDN,iv:oVlfibcNvXI7+AVLcqQxFAgrCXDwxmK5uxN2SHpbhY8=,tag:LUFsZqDvXvn4TvqRS98i4w==,type:str]
                      paths:
                        - path: ENC[AES256_GCM,data:aA==,iv:cx/Kn5TEsqlZOBE+RZ4l1aqAM4/QECFh1QfHHGZgwro=,tag:L/+vXkpu+QAyJWPM+v/zyA==,type:str]
                          pathType: ENC[AES256_GCM,data:dFU2j7Ld,iv:CI3f9hGvuxUoMBrYaclRABQsvNxWg/aw9+y8Sah6z9k=,tag:2cyHcUOz9vuycOELL6MnEA==,type:str]
                tls:
                    - hosts:
                        - ENC[AES256_GCM,data:iUt2smDhEFyM,iv:UAL/Lzab4zhjuHEsWhrQ0H5GkUXS291oxUmwdU2zljs=,tag:4oq88TbrMVT7SM3nV1QqEQ==,type:str]
        persistence:
            config:
                enabled: true
                type: pvc
                mountPath: /app/config
                readOnly: true
                accessMode: ReadWriteMany
                size: 1Gi
                storageClass: block
                retain: true
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1xl3fcwdw56k73lraxsjhde4ygwn7jw0js5l5qw7vsp54vc5czuwstcejxu
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBadWtJNHVjR1ZQL0lPcFhl
            UHVJMDdybzZJVDFwaTdKNytvelRhdE9UbVRJCmtiNmpsMERDQ3JlYllPbmtPK0th
            STRuWEQwQ1ROU3lJZmxJQklnUklUMGcKLS0tIGFSVGRVZHRodEsxTHJTcVpSUFpq
            eU1iQ24yT09uTENVTXR2UDdYY0YvOWcKVIGu5XXvtujn41eJSuJwTdP0Klc7yknF
            qcZ8WiHzD5IIzR7Q71YB3nt/h/KZIVRkc/ydyusNvrwuuWesChPKmQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-02-03T07:25:51Z"
    mac: ENC[AES256_GCM,data:Ff85N7c104e6B+0Q0rPGrlZR5x29Lv5f2D+Wjz/6HRXYfyTtVjyW9lm0TAeYitDge+2RoUBHums9KZVaRmTbGeulTKnX5yoTBPz20Y+6PxgBxoZbLRUZpkZCqL0Gx5QmE2L6tEE5mL93rWKa/K+hAx6I6v1s1mDU5+TGyo8OMnE=,iv:OWjpd5weB2Cv4BLF2iRPVbIH/XUbUUnnSzOtiwvdRw4=,tag:bTsgWxBRny+ixM/8a5E9EA==,type:str]
    pgp:
        - created_at: "2023-02-02T07:12:54Z"
          enc: |
            -----BEGIN PGP MESSAGE-----

            hF4DAAAAAAAAAAASAQdAQjggg2Je53Vah+/Uy9jWY4NgMEKIrXzggHIWK7ILv30w
            4KVyAuCRO0tIhd6A0dKXUg2CSBJ1CF9vBATHckwITrCn4kVa/jI6e/ffqVxha63v
            0l4BaAXHuiMVdm9dfA7yOMxyOAfO8qSlfr5z8YTFkltIFyyqbzh3kkltG/5TwYLy
            4GWtsvK+vxjAw7bZW1PmznOYrwWaM9BUAW8CVhTHn0ul+2IZHLOOvaLEb3Vc4CHg
            =8imY
            -----END PGP MESSAGE-----
          fp: 31E70E5BC80C58AFF5DD649921AC5A1AC6E5B7F2
    encrypted_regex: ^(hosts|host)$
    version: 3.7.3
