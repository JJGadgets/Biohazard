apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: gokapi
    namespace: gokapi
spec:
    interval: 15m
    chart:
        spec:
            chart: app-template
            version: 1.2.1
            sourceRef:
                kind: HelmRepository
                name: bjw-s
                namespace: flux-system
    maxHistory: 3
    install:
        createNamespace: true
        remediation:
            retries: 3
    upgrade:
        cleanupOnFail: true
        remediation:
            retries: 3
    uninstall:
        keepHistory: false
    values:
        controller:
            strategy: RollingUpdate
        image:
            repository: docker.io/f0rc3/gokapi
            tag: v1.6.1
        service:
            main:
                ports:
                    http:
                        port: 53842
            env:
                - GOKAPI_MAX_MEMORY_UPLOAD: "128"
            ingress:
                main:
                    enabled: true
                    ingressClassName: nginx
                    hosts:
                        - host: ENC[AES256_GCM,data:xM2m1JgIX5Nje0Az6Xr9o7iSpggl,iv:34wy7iv8Sq60sOcT+t61hC1RowWpKBoBWlUjmuMGrvg=,tag:jaoTQsFtrzvh0JR8jj+8PA==,type:str]
                          paths:
                            - path: ENC[AES256_GCM,data:UQ==,iv:6Ab7LRSullQyLVFmXQjk4KKs1Lvwrh1HZxfs2ptqDlE=,tag:vIgKH0ub6QgyO6EIcpAfrA==,type:str]
                              pathType: ENC[AES256_GCM,data:lEQliQRl,iv:3r+JuVS/5sSf9HgWgnHxCxvGdcinXINbHuSwNFkN8Gg=,tag:K/ypiPWBlGktadxthDkyAg==,type:str]
                    tls:
                        - hosts:
                            - ENC[AES256_GCM,data:jeBk9bBVZl9CisdDXAxH+GMR/TNs,iv:DYC89j7eyVydvRmhBqnn65h0H+jZyI1qF6U1rHn2arQ=,tag:f1zR2CWSig0f/+IaHwszig==,type:str]
                          secretName: long-domain-tls
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1xl3fcwdw56k73lraxsjhde4ygwn7jw0js5l5qw7vsp54vc5czuwstcejxu
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBadWtJNHVjR1ZQL0lPcFhl
            UHVJMDdybzZJVDFwaTdKNytvelRhdE9UbVRJCmtiNmpsMERDQ3JlYllPbmtPK0th
            STRuWEQwQ1ROU3lJZmxJQklnUklUMGcKLS0tIGFSVGRVZHRodEsxTHJTcVpSUFpq
            eU1iQ24yT09uTENVTXR2UDdYY0YvOWcKVIGu5XXvtujn41eJSuJwTdP0Klc7yknF
            qcZ8WiHzD5IIzR7Q71YB3nt/h/KZIVRkc/ydyusNvrwuuWesChPKmQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-02-02T07:28:04Z"
    mac: ENC[AES256_GCM,data:nzh7AHfB/9to2TkJO/ewnHCRY68sD6lfRxhFl84ZyOZNvnsv/2uQ7hfdVZC+pfvoYm6RtJ89fqaBh33np/BBLDl+pMDNGl0D9ekKn7cI7S49mYNsFaVz2tixQfO+fRfakw/47bXPk2tZvuhaqtHSQYn+d2E1jBzKo1izhqj3obE=,iv:cE5k6ACxAh0PY71NLnR2Cmdp12rupGYgEIWJjfI+0EM=,tag:e/GRpo7tB/tBYXxhAx9t2A==,type:str]
    pgp:
        - created_at: "2023-02-02T07:12:54Z"
          enc: |
            -----BEGIN PGP MESSAGE-----

            hF4DAAAAAAAAAAASAQdAQjggg2Je53Vah+/Uy9jWY4NgMEKIrXzggHIWK7ILv30w
            4KVyAuCRO0tIhd6A0dKXUg2CSBJ1CF9vBATHckwITrCn4kVa/jI6e/ffqVxha63v
            0l4BaAXHuiMVdm9dfA7yOMxyOAfO8qSlfr5z8YTFkltIFyyqbzh3kkltG/5TwYLy
            4GWtsvK+vxjAw7bZW1PmznOYrwWaM9BUAW8CVhTHn0ul+2IZHLOOvaLEb3Vc4CHg
            =8imY
            -----END PGP MESSAGE-----
          fp: 31E70E5BC80C58AFF5DD649921AC5A1AC6E5B7F2
    encrypted_regex: ^(hosts|host)$
    version: 3.7.3
