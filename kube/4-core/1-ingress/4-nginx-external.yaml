# yaml-language-server: $schema=https://kubernetes-schemas.devbu.io/helmrelease_v2beta1.json
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: ingress-nginx-ext
    namespace: ingress
spec:
    interval: 15m
    chart:
        spec:
            chart: ingress-nginx
            version: 4.4.2
            sourceRef:
                kind: HelmRepository
                name: ingress-nginx
                namespace: flux-system
    maxHistory: 3
    install:
        createNamespace: true
        remediation:
            retries: 3
    upgrade:
        cleanupOnFail: true
        remediation:
            retries: 3
    uninstall:
        keepHistory: false
    values:
        controller:
            replicaCount: 2
            extraEnvs:
                - name: TZ
                  value: Asia/Singapore
            service:
                externalIPs:
                    - ENC[AES256_GCM,data:n68xRk/0ryswzpc=,iv:l5xqWDz/wEcxTFx0kPEnCIZ/09fOjqw/iXvPktOwOf4=,tag:DIArpNOW1OnkEHpX3aQUog==,type:str]
                loadBalancerIP: ENC[AES256_GCM,data:JoNey2Ql+KpTQBc=,iv:mpg3TrUzV+wk6R5xDit318Y29rHzraCh2O+V8PCcCQc=,tag:5YQ4JRfG5tlbaGdLDPC/6g==,type:str]
                externalTrafficPolicy: Local
            publishService:
                enabled: true
            ingressClassByName: true
            ingressClassResource:
                name: external
                enabled: true
                default: false
                controllerValue: k8s.io/ingress-nginx-external
            config:
                client-body-timeout: 10
                client-header-timeout: 10
                enable-real-ip: "true"
                enable-brotli: "true"
                use-proxy-protocol: "true"
                use-forwarded-headers: "true"
                hsts-max-age: "31449600"
                hsts-preload: "true"
                keep-alive: 10
                disable-access-log: "true"
                log-format-escape-json: "true"
                proxy-body-size: 100K
                ssl-protocols: TLSv1.3 TLSv1.2
                hide-headers: Server,X-Powered-By
                enable-ocsp: "true"
                large-client-header-buffers: 2 1k
            # metrics:
            #   enabled: true
            #   serviceMonitor:
            #     enabled: true
            #     namespace: networking
            #     namespaceSelector:
            #       any: true
            extraArgs:
                default-ssl-certificate: ingress/short-domain-tls
            resources:
                requests:
                    cpu: 10m
                    memory: 250Mi
                limits:
                    memory: 500Mi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1xl3fcwdw56k73lraxsjhde4ygwn7jw0js5l5qw7vsp54vc5czuwstcejxu
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBCbWRBMWFUY0MySC9HSUxB
            bHFqbTBzam5lSDFTT0s1MVFpQ01mUytFdTNVCmhhbUJHK2ZmNnZLSXNGN1ZYam9G
            Q3hDKzBOZ1BqWkxLd3ZWZ2NSU2k1VTAKLS0tIEU2RmRQMXJZMVhwT2lZWUFMM0ds
            aisrc3h1QmhIQmEwQkdzVE80VjV6LzAKr3e/xgLoKefqHbc/RCav+HZXTAIA3nwB
            oPIkDQoXTSH5XYz57PSZQQ1K5atiJ+U/58A5TNIDyQqv1xVfE3V6RA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-02-15T23:48:27Z"
    mac: ENC[AES256_GCM,data:Bw7qPKIHO3aRAUOJqIC2beHBUzqsxk34xxuYBU4s5RCZzcGqeOJDXrI6kOI8sT6XywtwLXd7xYSeCSeodeJ0WQKeeEekEN+GJ3Ej8a0QPB2K/4ulcAFLBw8QUzLnw0ucM+OdshMNHc2Lp/qhHakiCWvrVwZZA+Rc8iV18WMmjNE=,iv:Y8T+30A8EKaq7p1QRKJypMtB7HbvmUex3tpg26L/FZg=,tag:V8H8x1Ko9cAB+zk3AteVyw==,type:str]
    pgp:
        - created_at: "2023-02-15T23:32:45Z"
          enc: |
            -----BEGIN PGP MESSAGE-----

            hF4DAAAAAAAAAAASAQdALigKg9ofDCG0uKuaGyou74TdXQ9WRyyMUeIs8cx5hD0w
            aYq+awo64gECxQdhnhotmGKXhG/G4fcnGDxnDbDPqYD8L2ljuWZgzj4irVek7+QT
            0l4B9Brrg/6R8gqmEqVW2Ji5TFYdN6j9FBiZtQUQluz6aqCdvhWnUgOcECQn5Q2M
            0sHsCLWhXBF0R4Y3EJG12cBU2dmDIiL2rcVhiBt7srj2wHxOVaiX6mv+Jl0Q1Ru5
            =yvdi
            -----END PGP MESSAGE-----
          fp: 31E70E5BC80C58AFF5DD649921AC5A1AC6E5B7F2
    encrypted_regex: ^(data|stringData|commonName|dnsNames|externalIPs|loadBalancerIP|whitelist-source-range)$
    version: 3.7.3
