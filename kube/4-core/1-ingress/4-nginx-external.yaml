apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: ingress-nginx-ext
    namespace: ingress
spec:
    interval: 15m
    chart:
        spec:
            chart: ingress-nginx
            version: 4.4.2
            sourceRef:
                kind: HelmRepository
                name: ingress-nginx
                namespace: flux-system
    maxHistory: 3
    install:
        createNamespace: true
        remediation:
            retries: 3
    upgrade:
        cleanupOnFail: true
        remediation:
            retries: 3
    uninstall:
        keepHistory: false
    values:
        tcp:
            "42080": ingress/ingress-nginx-controller:2080::PROXY
            "42443": ingress/ingress-nginx-controller:2443::PROXY
        controller:
            replicaCount: 1
            # kind: DaemonSet
            extraEnvs:
                - name: TZ
                  value: Asia/Singapore
            service:
                type: NodePort
                externalIPs:
                    - ENC[AES256_GCM,data:UFPqnan8R+Skj1mp,iv:R0LrBjRNcPBK5DsgnL3dFeI9524gGChAQkhJO2znbFs=,tag:dN/D4ItFO2NfJdI5Kv+0sg==,type:str]
                externalTrafficPolicy: Local
                ports:
                    http: 80
                    https: 443
                targetPorts:
                    http: 42080
                    https: 42443
                nodePorts:
                    http: 80
                    https: 443
            containerPort:
                internalhttp: 42080
                internalhttps: 42443
            publishService:
                enabled: true
            ingressClassByName: false
            ingressClassResource:
                enabled: false
            nodeSelector:
                node-restriction.kubernetes.io/nodeType: awsIngress
            resources:
                requests:
                    cpu: 10m
                    memory: 250Mi
                limits:
                    memory: 500Mi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1xl3fcwdw56k73lraxsjhde4ygwn7jw0js5l5qw7vsp54vc5czuwstcejxu
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBCbWRBMWFUY0MySC9HSUxB
            bHFqbTBzam5lSDFTT0s1MVFpQ01mUytFdTNVCmhhbUJHK2ZmNnZLSXNGN1ZYam9G
            Q3hDKzBOZ1BqWkxLd3ZWZ2NSU2k1VTAKLS0tIEU2RmRQMXJZMVhwT2lZWUFMM0ds
            aisrc3h1QmhIQmEwQkdzVE80VjV6LzAKr3e/xgLoKefqHbc/RCav+HZXTAIA3nwB
            oPIkDQoXTSH5XYz57PSZQQ1K5atiJ+U/58A5TNIDyQqv1xVfE3V6RA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-02-19T18:34:09Z"
    mac: ENC[AES256_GCM,data:Y43QivFeao3o/xd/Kpg/Xv6kvbCPi7oh9MXnvWNZAGFswdOd3k81zg6Me9fIw0heimcggmugtT0ztRUYUu63Zj8x37TS9+E4Z4nsssFF7dV2o7kCZdyTybhnyVNtuXuO1d/Iqg1YsZrdTZWsSHd86ehFQbl4qb7NQmePYX09dIs=,iv:a0/OWcpsXhUXHG+J8qc7aOX2Rs+PbdMpsY+sqVLvZhw=,tag:/jUk8Wkpot6ziDK0smBBcw==,type:str]
    pgp:
        - created_at: "2023-02-15T23:32:45Z"
          enc: |
            -----BEGIN PGP MESSAGE-----

            hF4DAAAAAAAAAAASAQdALigKg9ofDCG0uKuaGyou74TdXQ9WRyyMUeIs8cx5hD0w
            aYq+awo64gECxQdhnhotmGKXhG/G4fcnGDxnDbDPqYD8L2ljuWZgzj4irVek7+QT
            0l4B9Brrg/6R8gqmEqVW2Ji5TFYdN6j9FBiZtQUQluz6aqCdvhWnUgOcECQn5Q2M
            0sHsCLWhXBF0R4Y3EJG12cBU2dmDIiL2rcVhiBt7srj2wHxOVaiX6mv+Jl0Q1Ru5
            =yvdi
            -----END PGP MESSAGE-----
          fp: 31E70E5BC80C58AFF5DD649921AC5A1AC6E5B7F2
    encrypted_regex: ^(data|stringData|commonName|dnsNames|externalIPs|loadBalancerIP|whitelist-source-range)$
    version: 3.7.3
