# yaml-language-server: $schema=https://kubernetes-schemas.devbu.io/helmrelease_v2beta1.json
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: ingress-nginx
    namespace: ingress
spec:
    interval: 15m
    chart:
        spec:
            chart: ingress-nginx
            version: 4.4.2
            sourceRef:
                kind: HelmRepository
                name: ingress-nginx
                namespace: flux-system
    maxHistory: 3
    install:
        createNamespace: true
        remediation:
            retries: 3
    upgrade:
        cleanupOnFail: true
        remediation:
            retries: 3
    uninstall:
        keepHistory: false
    values:
        controller:
            replicaCount: 3
            extraEnvs:
                - name: TZ
                  value: Asia/Singapore
            service:
                externalIPs:
                    - ENC[AES256_GCM,data:D0xMPtfAVkuv,iv:7cF1Lc24Wsdqhpxc+PoL22JdIA503VJK/+lseERwfTo=,tag:W13yClE6viOIfIgKy3CA4w==,type:str]
                externalTrafficPolicy: Local
            publishService:
                enabled: true
            ingressClassResource:
                default: true
            config:
                client-body-buffer-size: 100M
                client-body-timeout: 120
                client-header-timeout: 120
                enable-brotli: "true"
                enable-real-ip: "true"
                use-forwarded-headers: "true"
                hsts-max-age: "31449600"
                keep-alive-requests: 10000
                keep-alive: 120
                log-format-escape-json: "true"
                log-format-upstream: |
                    {"time": "$time_iso8601", "remote_addr": "$proxy_protocol_addr", "x_forwarded_for": "$proxy_add_x_forwarded_for", "request_id": "$req_id", "remote_user": "$remote_user", "bytes_sent": $bytes_sent, "request_time": $request_time, "status": $status, "vhost": "$host", "request_proto": "$server_protocol", "path": "$uri", "request_query": "$args", "request_length": $request_length, "duration": $request_time,"method": "$request_method", "http_referrer": "$http_referer", "http_user_agent": "$http_user_agent"}
                proxy-body-size: 0
                proxy-buffer-size: 16k
                ssl-protocols: TLSv1.3 TLSv1.2
            # metrics:
            #   enabled: true
            #   serviceMonitor:
            #     enabled: true
            #     namespace: networking
            #     namespaceSelector:
            #       any: true
            extraArgs:
                default-ssl-certificate: ingress/short-domain
            resources:
                requests:
                    cpu: 10m
                    memory: 250Mi
                limits:
                    memory: 500Mi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age: []
    lastmodified: "2023-01-29T07:49:35Z"
    mac: ENC[AES256_GCM,data:9pYDjAI1EQO0UhOpV1qzv9AVa04ZyqdRn1Gb/dvfUXHm0uhOC+zDNiTnCySlcL/nhNS4jOwLhBUfK8yHRX8uBkWIFbOgoOWpJ05iPuCJM9XESivBy+CoYcAKmhy2u9CwvplDCvfP9zR6xjcZVIedX9guZjxOopYaS4l2GSTZRNc=,iv:7KkBLUQVrJthLQpFPzf5lPPiaLhKh4RI4wuxuh758/s=,tag:tiAAjsmnauR/i9sxi8Kxrg==,type:str]
    pgp:
        - created_at: "2023-01-29T07:49:34Z"
          enc: |
            -----BEGIN PGP MESSAGE-----

            hF4DAAAAAAAAAAASAQdAk5nWX4DM6JoPx3FOn8S/PhI8mCHBuUl+0JBpnsE3Qisw
            +RRLnQsBqyHXJuV51kQh2UDGqblHJt77fds8qWuZH1imG4seCz8K5XkqlcjWsFKr
            0l4Bznc6Ihhm5BNh1RpWa2ztoWnZYeg7nkcvxsSJtkpwAOM5ebBEeQklkt+0Iwwb
            2ME5XczvWCrDJ7G1mr3uYkud181k7Tv7/9RPy7Yl5x1DMGSl8HLEfZUnpjfa+1FY
            =jkKQ
            -----END PGP MESSAGE-----
          fp: 31E70E5BC80C58AFF5DD649921AC5A1AC6E5B7F2
    encrypted_regex: ^(data|stringData|commonName|dnsNames|externalIPs)$
    version: 3.7.3
