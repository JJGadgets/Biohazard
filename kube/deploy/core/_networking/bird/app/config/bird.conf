router id ${IP_CLUSTER_VIP};
define ASN = ${ASN_CLUSTER_NODES};
filter cilium {
  if (net ~ ${IP_LB_CIDR}) then accept;
  else reject;
}
filter cilium_host {
  if (net ~ ${IP_LB_CIDR}) then {
    onlink = true;
    ifname = "cilium_host";
    accept;
  }
  else reject;
}
filter nodes {
  if (net ~ ${IP_ROUTER_VLAN_K8S_CIDR}) then accept;
  else reject;
}
protocol device {
}
protocol direct {
  ipv4 {
    import all
  };
}
protocol kernel {
  learn all;
  scan time 10;
  ipv4 {
    import all;
    export filter cilium_self;
  };
}
protocol static {
  disabled;
  ipv4;
}
protocol bgp CiliumBGP {
  ipv4 {
    next hop self;
    import filter cilium;
  };
  multihop;
  local port 61790 as ASN;
  neighbor range ${IP_ROUTER_VLAN_K8S_CIDR} as ASN internal;
}
protocol ospf Starling {
  ipv4 {
    import all;
    export filter cilium;
  };
  area ${OSPF_AREA_STARLING} {
    interface ${IP_ROUTER_VLAN_K8S_CIDR} {
      type broadcast;
    };
  };
}
