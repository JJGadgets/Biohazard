---
# yaml-language-server: $schema=https://github.com/JustinGrote/FluentBitJsonSchema/releases/latest/download/fluentbit.schema.json
service:
  daemon: off
  log_level: debug
  http_server: "on"
  http_listen: "[::]"
  http_port: 8080
  parsers_file: /fluent-bit/etc/parsers.conf
pipeline:
  inputs:
    - name: syslog
      alias: fortigate
      mode: udp
      port: 51401
      parser: syslog-rfc5424
      buffer_chunk_size: 2048000
      # tls: "on"
      # tls.debug: 4
      # tls.verify: "off"
      # tls.crt_file: /tls/tls.crt
      # tls.key_file: /tls/tls.key
      # tag: fortigate.*
  filters:
    - name: parser
      match: "*"
      key_name: message
      parser: logfmt
      reserve_data: true
      preserve_key: true
  outputs:
    - name: http
      match: "*"
      host: victoria-logs-victoria-logs-single-server.monitoring.svc.cluster.local
      port: 9428
      uri: >-
        /insert/jsonline?_stream_fields=host,type,subtype,vd&_msg_field=message&_time_field=date
      compress: gzip
      format: json_lines
      json_date_format: iso8601
      header:
        - 'AccountID 51401'
        - 'ProjectID 0'
      log_response_payload: "on"
    # stdout
    - name: stdout
      match: '*'
      format: json_lines
      json_date_format: iso8601
